---
name: Memory List & Cards
status: open
created: 2025-10-14T21:12:26Z
updated: 2025-10-14T21:12:26Z
github: null
depends_on: [001]
parallel: true
conflicts_with: [008]
---

# Task 004: Memory List & Cards

## Description

Build the memory display components that show users their saved memories in a card-based list view. This task creates the visual foundation for memory browsing, implementing the main container (`MemoryList`) and individual card components (`MemoryCard`) with support for expand/collapse, type badges, and empty states.

This component uses **Dexie live queries** via `useLiveQuery()` to automatically re-render when memories are added, updated, or deleted - providing real-time reactivity without manual subscriptions.

## Acceptance Criteria

- [ ] `MemoryList.tsx` container component displays all memories in reverse chronological order
- [ ] `MemoryCard.tsx` component shows memory content, type badge, timestamp, and tags
- [ ] Cards support expand/collapse for long content (>200 characters)
- [ ] Type badges are color-coded (knowledge: blue, experience: green, method: purple)
- [ ] Empty state component displays "Create your first memory" when no memories exist
- [ ] Uses Dexie `useLiveQuery()` for reactive updates (no manual subscriptions)
- [ ] List updates automatically when memories are created/edited/deleted
- [ ] Responsive design works on mobile (single column) and desktop (max 3 columns)
- [ ] Keyboard navigation supported (arrow keys to navigate cards)
- [ ] Cards are accessible (proper ARIA labels, semantic HTML)

## Technical Details

### Components to Create

**1. MemoryList.tsx**
```typescript
// src/components/memories/MemoryList.tsx
import { useLiveQuery } from 'dexie-react-hooks';
import { db } from '@/lib/db';
import MemoryCard from './MemoryCard';
import EmptyState from '../layout/EmptyState';

export default function MemoryList() {
  // Dexie live query - auto re-renders on DB changes
  const memories = useLiveQuery(
    () => db.memories.orderBy('createdAt').reverse().toArray()
  );

  // Loading state
  if (!memories) {
    return <div>Loading memories...</div>;
  }

  // Empty state
  if (memories.length === 0) {
    return <EmptyState />;
  }

  return (
    <div className="memory-list">
      {memories.map(memory => (
        <MemoryCard key={memory.id} memory={memory} />
      ))}
    </div>
  );
}
```

**2. MemoryCard.tsx**
```typescript
// src/components/memories/MemoryCard.tsx
import { useState } from 'react';
import { Memory } from '@/lib/db';
import { formatRelativeTime } from '@/lib/utils/date';

interface MemoryCardProps {
  memory: Memory;
}

export default function MemoryCard({ memory }: MemoryCardProps) {
  const [isExpanded, setIsExpanded] = useState(false);
  const isLong = memory.content.length > 200;

  return (
    <article
      className="memory-card"
      aria-label={`${memory.type} memory`}
      tabIndex={0}
    >
      <header>
        <span className={`badge badge-${memory.type}`}>
          {memory.type}
        </span>
        <time dateTime={memory.createdAt.toISOString()}>
          {formatRelativeTime(memory.createdAt)}
        </time>
      </header>

      <div className="content">
        {isLong && !isExpanded ? (
          <>
            <p>{memory.content.slice(0, 200)}...</p>
            <button onClick={() => setIsExpanded(true)}>
              Show more
            </button>
          </>
        ) : (
          <>
            <p>{memory.content}</p>
            {isLong && (
              <button onClick={() => setIsExpanded(false)}>
                Show less
              </button>
            )}
          </>
        )}
      </div>

      {memory.tags && memory.tags.length > 0 && (
        <footer>
          {memory.tags.map(tag => (
            <span key={tag} className="tag">
              #{tag}
            </span>
          ))}
        </footer>
      )}
    </article>
  );
}
```

**3. EmptyState.tsx**
```typescript
// src/components/layout/EmptyState.tsx
export default function EmptyState() {
  return (
    <div className="empty-state">
      <h2>No memories yet</h2>
      <p>Start a conversation to create your first memory</p>
      <svg><!-- Illustration --></svg>
    </div>
  );
}
```

### Styling Requirements

**Tailwind CSS Classes:**
- Memory cards: `bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow`
- Type badges: `badge-knowledge` (blue), `badge-experience` (green), `badge-method` (purple)
- Responsive grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
- Empty state: Center vertically and horizontally with icon

### Files to Create/Modify

- **Create:** `src/components/memories/MemoryList.tsx` (~80 lines)
- **Create:** `src/components/memories/MemoryCard.tsx` (~120 lines)
- **Create:** `src/components/layout/EmptyState.tsx` (~40 lines)
- **Create:** `src/lib/utils/date.ts` (helper for relative time formatting)
- **Modify:** `src/App.tsx` (integrate MemoryList into main layout)

### Testing Strategy

**Unit Tests (Jest + RTL):**
```typescript
describe('MemoryCard', () => {
  it('displays memory content and type badge', () => {
    const memory = {
      id: 1,
      content: 'Test memory',
      type: 'knowledge',
      createdAt: new Date(),
      updatedAt: new Date(),
    };
    render(<MemoryCard memory={memory} />);
    expect(screen.getByText('Test memory')).toBeInTheDocument();
    expect(screen.getByText('knowledge')).toBeInTheDocument();
  });

  it('collapses long content by default', () => {
    const longContent = 'a'.repeat(300);
    const memory = { /* ... */ content: longContent };
    render(<MemoryCard memory={memory} />);
    expect(screen.getByText(/show more/i)).toBeInTheDocument();
  });

  it('expands content when "Show more" clicked', async () => {
    // Test expand/collapse toggle
  });
});

describe('MemoryList', () => {
  it('displays empty state when no memories', () => {
    // Mock useLiveQuery to return []
  });

  it('displays all memories in reverse chronological order', () => {
    // Mock useLiveQuery with test data
  });
});
```

**Integration Test:**
```typescript
describe('Memory Display Integration', () => {
  it('updates list when new memory created', async () => {
    render(<App />);

    // Initially empty
    expect(screen.getByText(/no memories yet/i)).toBeInTheDocument();

    // Create memory via conversation
    await userEvent.type(screen.getByRole('textbox'), 'Test memory');
    await userEvent.click(screen.getByRole('button', { name: /send/i }));

    // Memory card appears automatically (via live query)
    await waitFor(() => {
      expect(screen.getByText('Test memory')).toBeInTheDocument();
    });
  });
});
```

## Dependencies

**Depends on:**
- [001] Database Operations & Hooks - Requires `db.memories` table and basic CRUD operations

**Blocks:**
- [005] Search & Filters - Needs MemoryList container to add filters to
- [006] Memory Actions - Needs MemoryCard to add edit/delete buttons to

**Can run parallel with:**
- [002] Basic Chat Interface - Independent feature
- [003] Memory Extraction & Creation - Independent feature

**Conflicts with:**
- [008] Layout & Polish - Both modify same components; 008 should come last

## Effort Estimate

**Total:** 1 day (8 hours)

**Breakdown:**
- `MemoryList.tsx` + Dexie integration: 2 hours
- `MemoryCard.tsx` with expand/collapse: 3 hours
- `EmptyState.tsx` + styling: 1 hour
- Unit tests: 1.5 hours
- Integration testing + polish: 0.5 hours

**Risk buffer:** Low risk - straightforward React components with well-documented Dexie patterns

## Definition of Done

- [ ] All components implemented and styled
- [ ] Dexie live queries working (automatic updates verified)
- [ ] Unit tests written and passing (>90% coverage)
- [ ] Integration test verifies live query reactivity
- [ ] Responsive design tested on mobile and desktop
- [ ] Keyboard navigation works
- [ ] Accessibility audit passed (WCAG 2.1 AA)
- [ ] Code reviewed and merged to main branch
- [ ] No TypeScript errors
- [ ] No ESLint warnings
- [ ] Manual testing: Can view memories, cards display correctly, empty state shows when appropriate

---

**Related:** Epic [core-user-journey](./epic.md) | Next: [005-search-filters.md](./005.md)
