---
name: AI Setup UI Components & Loading States
status: open
created: 2025-10-14T03:28:21Z
updated: 2025-10-14T03:44:38Z
github: https://github.com/tgarrochinho/lumara-frontend/issues/16
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: AI Setup UI Components & Loading States

## Description
Create user interface components for AI setup, status indication, and progress tracking. Provide clear feedback during model loading and show AI readiness status throughout the app.

## Acceptance Criteria
- [ ] AISetup wizard component guides first-time setup
- [ ] AIStatus indicator shows current AI state
- [ ] Progress bar shows model download progress
- [ ] Loading states prevent user action during initialization
- [ ] Error states show clear messages and retry options
- [ ] Success states confirm AI is ready
- [ ] Components are accessible (ARIA labels, keyboard navigation)
- [ ] Responsive design (mobile + desktop)

## Technical Details

### Files to Create
```
src/components/ai/
‚îú‚îÄ‚îÄ AISetup.tsx              # Setup wizard
‚îú‚îÄ‚îÄ AIStatus.tsx             # Status indicator
‚îú‚îÄ‚îÄ AILoadingState.tsx       # Loading UI
‚îú‚îÄ‚îÄ AIErrorState.tsx         # Error UI
‚îî‚îÄ‚îÄ types.ts                 # Component types

src/hooks/
‚îî‚îÄ‚îÄ useAIStatus.ts           # Hook for AI state
```

### Implementation

1. **useAIStatus Hook** (`src/hooks/useAIStatus.ts`)
```typescript
import { useState, useEffect } from 'react';
import { selectProvider } from '@/lib/ai/registry';
import { AIProvider } from '@/lib/ai/types';

export type AIStatus = 'uninitialized' | 'initializing' | 'ready' | 'error';

export interface UseAIStatusResult {
  status: AIStatus;
  provider: AIProvider | null;
  error: Error | null;
  progress: number;
  initialize: () => Promise<void>;
  retry: () => Promise<void>;
}

export function useAIStatus(): UseAIStatusResult {
  const [status, setStatus] = useState<AIStatus>('uninitialized');
  const [provider, setProvider] = useState<AIProvider | null>(null);
  const [error, setError] = useState<Error | null>(null);
  const [progress, setProgress] = useState(0);

  const initialize = async () => {
    setStatus('initializing');
    setError(null);
    setProgress(0);

    try {
      // Select provider (Chrome AI for now)
      const aiProvider = await selectProvider('chrome-ai');

      // Initialize embeddings with progress tracking
      const { embeddingsService } = await import('@/lib/ai/embeddings/transformers');

      await embeddingsService.initialize((prog) => {
        setProgress(prog);
      });

      setProvider(aiProvider);
      setStatus('ready');
      setProgress(100);
    } catch (err) {
      setError(err as Error);
      setStatus('error');
    }
  };

  const retry = async () => {
    await initialize();
  };

  // Auto-initialize on mount
  useEffect(() => {
    initialize();
  }, []);

  return {
    status,
    provider,
    error,
    progress,
    initialize,
    retry,
  };
}
```

2. **AISetup Component** (`src/components/ai/AISetup.tsx`)
```typescript
import { useAIStatus } from '@/hooks/useAIStatus';
import { AILoadingState } from './AILoadingState';
import { AIErrorState } from './AIErrorState';

export function AISetup() {
  const { status, progress, error, retry } = useAIStatus();

  if (status === 'ready') {
    return (
      <div className="ai-setup-success">
        <div className="success-icon">‚úì</div>
        <h2>AI Ready!</h2>
        <p>Everything runs on your device. Your privacy is protected.</p>
      </div>
    );
  }

  if (status === 'error') {
    return <AIErrorState error={error} onRetry={retry} />;
  }

  if (status === 'initializing') {
    return (
      <AILoadingState
        progress={progress}
        message={
          progress < 50
            ? 'Downloading AI models...'
            : 'Almost ready...'
        }
      />
    );
  }

  return null;
}
```

3. **AILoadingState Component** (`src/components/ai/AILoadingState.tsx`)
```typescript
export interface AILoadingStateProps {
  progress: number;
  message?: string;
}

export function AILoadingState({ progress, message }: AILoadingStateProps) {
  return (
    <div className="ai-loading-state">
      <div className="loading-spinner" />

      <h3>Setting up AI</h3>

      {message && <p className="loading-message">{message}</p>}

      <div className="progress-bar">
        <div
          className="progress-fill"
          style={{ width: `${progress}%` }}
        />
      </div>

      <p className="progress-text">{Math.round(progress)}%</p>

      <p className="privacy-note">
        üîí Models download once and stay on your device
      </p>
    </div>
  );
}
```

4. **AIErrorState Component** (`src/components/ai/AIErrorState.tsx`)
```typescript
export interface AIErrorStateProps {
  error: Error | null;
  onRetry: () => void;
}

export function AIErrorState({ error, onRetry }: AIErrorStateProps) {
  const errorMessage = error?.message || 'Unknown error occurred';

  const isChromeMissing = errorMessage.includes('Chrome AI not available');
  const isNetworkError = errorMessage.includes('network') || errorMessage.includes('fetch');

  return (
    <div className="ai-error-state">
      <div className="error-icon">‚ö†Ô∏è</div>

      <h3>AI Setup Failed</h3>

      <p className="error-message">{errorMessage}</p>

      {isChromeMissing && (
        <div className="help-text">
          <h4>Chrome AI Required</h4>
          <p>This app requires Chrome Canary or Chrome Dev with the Prompt API enabled.</p>
          <a
            href="https://developer.chrome.com/docs/ai/built-in"
            target="_blank"
            rel="noopener noreferrer"
          >
            Learn how to enable ‚Üí
          </a>
        </div>
      )}

      {isNetworkError && (
        <div className="help-text">
          <h4>Network Issue</h4>
          <p>Could not download AI models. Check your internet connection.</p>
        </div>
      )}

      <button onClick={onRetry} className="retry-button">
        Try Again
      </button>
    </div>
  );
}
```

5. **AIStatus Indicator** (`src/components/ai/AIStatus.tsx`)
```typescript
import { useAIStatus } from '@/hooks/useAIStatus';

export function AIStatus() {
  const { status, provider } = useAIStatus();

  const statusConfig = {
    uninitialized: { icon: '‚ö™', text: 'AI Offline', color: 'gray' },
    initializing: { icon: 'üîÑ', text: 'AI Loading...', color: 'blue' },
    ready: { icon: 'üü¢', text: 'AI Ready', color: 'green' },
    error: { icon: 'üî¥', text: 'AI Error', color: 'red' },
  };

  const config = statusConfig[status];

  return (
    <div className={`ai-status ai-status-${config.color}`}>
      <span className="status-icon">{config.icon}</span>
      <span className="status-text">{config.text}</span>
      {provider && (
        <span className="provider-name">{provider.name}</span>
      )}
    </div>
  );
}
```

### Styling
```css
/* src/components/ai/ai-components.css */
.ai-setup-success,
.ai-loading-state,
.ai-error-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem;
  max-width: 500px;
  margin: 0 auto;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin: 1rem 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #6366f1, #8b5cf6);
  transition: width 0.3s ease;
}

.ai-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.875rem;
}

.status-icon {
  font-size: 1rem;
}
```

## Dependencies
- [ ] Task 001 (Provider Infrastructure)
- [ ] Task 002 (Embeddings)
- [ ] React 19 (already installed)

## Effort Estimate
- **Size:** M (Medium)
- **Hours:** 10-12 hours
- **Parallel:** No - Depends on Tasks 001, 002

## Definition of Done
- [ ] All UI components created and styled
- [ ] useAIStatus hook working
- [ ] Progress tracking accurate
- [ ] Error states comprehensive
- [ ] Accessible (WCAG AA)
- [ ] Responsive design
- [ ] Unit tests for components
- [ ] Storybook stories (optional)
